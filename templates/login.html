{% extends "base.html" %}

{% block content %}
<div class="campuskey-login-container">
    <!-- Left Side: Login Form -->
    <div class="login-form-section">
        <div class="login-form-content">
            <!-- CAMPUSKEY Logo -->
            <div class="campuskey-logo">
                <svg width="80" height="80" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
                    <defs>
                        <linearGradient id="keyGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                    <!-- Key shape -->
                    <path d="M45 20 L55 20 L55 30 L50 35 L55 40 L55 50 L50 55 L40 55 L35 50 L30 50 L25 55 L15 55 L10 50 L10 40 L20 30 L20 25 L25 20 Z" fill="url(#keyGrad)" stroke="#333" stroke-width="1.5"/>
                    <!-- Key hole -->
                    <circle cx="30" cy="40" r="8" fill="white"/>
                    <rect x="28" y="35" width="4" height="10" fill="white"/>
                    <!-- Key teeth -->
                    <rect x="45" y="25" width="8" height="3" fill="white" rx="1"/>
                    <rect x="48" y="32" width="6" height="3" fill="white" rx="1"/>
                </svg>
            </div>
            
            <h1 class="campuskey-title">ðŸ”‘ CAMPUSKEY</h1>
            
            {% if error %}
            <div class="error-message">{{ error }}</div>
            {% endif %}

            {% if success_message %}
            <div class="success-message">{{ success_message }}</div>
            {% endif %}

            <form method="POST" class="campuskey-login-form" id="loginForm">
                <div class="form-group">
                    <label for="username">Username*</label>
                    <input type="text" id="username" name="username" required>
                </div>
                
                <div class="form-group">
                    <label for="email">Email Address*</label>
                    <div class="email-input-group">
                        <input type="email" id="email" name="email" placeholder="your.email@example.com" required>
                        <button type="button" id="sendCodeBtn" class="btn-send-code" onclick="sendEmailCode()">Send Code</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="otp_code">Verification Code*</label>
                    <input type="text" id="otp_code" name="otp_code" placeholder="6-digit code" required>
                    <small id="codeHint">Enter the code sent to your email</small>
                </div>

                <div class="form-links">
                    <a href="#" class="forgot-password">Forgot my password</a>
                </div>

                <button type="submit" class="btn-login">LOGIN</button>

                <div class="mfa-link">
                    <a href="#">Protect your account with MFA. Learn more here.</a>
                </div>
            </form>

            <!-- Alternative Authentication Methods -->
            <div class="alt-auth-section">
                <div class="alt-auth-divider">
                    <span>or sign in with</span>
                </div>
                
                <div class="alt-auth-buttons">
                    <button type="button" class="btn-alt-auth btn-biometric" onclick="simulateBiometric()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                        </svg>
                        Face Recognition
                    </button>
                    
                    <button type="button" class="btn-alt-auth btn-rfid" onclick="simulateRFID()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="16" rx="2" ry="2"/>
                            <line x1="7" y1="8" x2="17" y2="8"/>
                            <line x1="7" y1="12" x2="17" y2="12"/>
                            <line x1="7" y1="16" x2="12" y2="16"/>
                        </svg>
                        RFID Card
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Side: Scenic Image -->
    <div class="login-image-section">
        <div class="scenic-image"></div>
    </div>
</div>

<script>
function sendEmailCode() {
    const username = document.getElementById('username').value;
    const email = document.getElementById('email').value;
    
    if (!username) {
        alert('Please enter your username first');
        return;
    }
    
    if (!email) {
        alert('Please enter your email address');
        return;
    }
    
    const btn = document.getElementById('sendCodeBtn');
    btn.disabled = true;
    btn.textContent = 'Sending...';
    
    fetch('/api/send-email-code', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            username: username,
            email: email
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Verification code sent to ' + email + '\n\nCheck your email or terminal for the code.');
            document.getElementById('codeHint').textContent = 'Code sent! Check your email or terminal.';
        } else {
            alert('Error: ' + (data.error || 'Failed to send code'));
        }
    })
    .catch(error => {
        alert('Error sending code: ' + error);
    })
    .finally(() => {
        btn.disabled = false;
        btn.textContent = 'Send Code';
    });
}

function simulateBiometric() {
    const username = document.getElementById('username').value;
    
    if (!username) {
        alert('Please enter your username first');
        return;
    }
    
    fetch('/api/biometric-login', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            username: username
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Biometric authentication successful!\n\nRedirecting to dashboard...');
            window.location.href = '/dashboard';
        } else {
            alert('Error: ' + (data.error || 'Biometric authentication failed'));
        }
    })
    .catch(error => {
        alert('Error: ' + error);
    });
}

function simulateRFID() {
    const username = document.getElementById('username').value;
    
    if (!username) {
        alert('Please enter your username first');
        return;
    }
    
    fetch('/api/rfid-login', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            username: username
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('RFID card authentication successful!\n\nRedirecting to dashboard...');
            window.location.href = '/dashboard';
        } else {
            alert('Error: ' + (data.error || 'RFID authentication failed'));
        }
    })
    .catch(error => {
        alert('Error: ' + error);
    });
}
</script>
{% endblock %}

