<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAMPUSKEY - Secure Access</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    {% if current_user.is_authenticated and request.endpoint != 'login' %}
    <!-- Top Header Bar -->
    <header class="top-header">
        <div class="header-left">
            <div class="logo-square">
                <svg width="24" height="24" viewBox="0 0 80 80">
                    <path d="M45 20 L55 20 L55 30 L50 35 L55 40 L55 50 L50 55 L40 55 L35 50 L30 50 L25 55 L15 55 L10 50 L10 40 L20 30 L20 25 L25 20 Z" fill="white"/>
                    <circle cx="30" cy="40" r="8" fill="#667eea"/>
                    <rect x="28" y="35" width="4" height="10" fill="#667eea"/>
                </svg>
            </div>
            <span class="header-title">CAMPUSKEY</span>
        </div>
        <div class="header-center">
            <!-- Empty center for now -->
        </div>
        <div class="header-right">
            <div class="user-avatar">
                {{ current_user.username[0].upper() }}
            </div>
        </div>
    </header>

    <!-- Main Layout -->
    <div class="app-layout">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <a href="{% if current_user.role == 'admin' %}{{ url_for('admin_dashboard') }}{% elif current_user.role == 'professor' %}{{ url_for('professor_dashboard') }}{% else %}{{ url_for('student_dashboard') }}{% endif %}" class="nav-item {% if 'dashboard' in request.endpoint %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    <span>Dashboard</span>
                </a>
                
                {% if current_user.role == 'admin' and current_user.username == 'admin' %}
                <a href="{{ url_for('admin') }}" class="nav-item {% if request.endpoint == 'admin' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    <span>Manage Users</span>
                </a>
                <a href="{{ url_for('admin_grades') }}" class="nav-item {% if request.endpoint == 'admin_grades' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                    </svg>
                    <span>Grades</span>
                </a>
                <a href="{{ url_for('login_logs') }}" class="nav-item {% if request.endpoint == 'login_logs' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <span>Login Logs</span>
                </a>
                {% elif current_user.role == 'professor' %}
                <a href="{{ url_for('professor_courses') }}" class="nav-item {% if request.endpoint == 'professor_courses' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                    </svg>
                    <span>My Courses</span>
                </a>
                <a href="{{ url_for('give_grades') }}" class="nav-item {% if request.endpoint == 'give_grades' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                    </svg>
                    <span>Give Grades</span>
                </a>
                {% elif current_user.role == 'student' %}
                <a href="{{ url_for('student_grades') }}" class="nav-item {% if request.endpoint == 'student_grades' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                    </svg>
                    <span>My Grades</span>
                </a>
                <a href="{{ url_for('student_courses') }}" class="nav-item {% if request.endpoint == 'student_courses' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                    </svg>
                    <span>My Courses</span>
                </a>
                {% endif %}
                
                <div class="nav-divider"></div>
                
                <!-- Common Security Items for All Roles -->
                <a href="{{ url_for('report_issue') }}" class="nav-item {% if request.endpoint == 'report_issue' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="9" y1="15" x2="15" y2="15"></line>
                        <line x1="12" y1="12" x2="12" y2="18"></line>
                    </svg>
                    <span>Report an Issue</span>
                </a>
                <a href="{{ url_for('security_guidelines') }}" class="nav-item {% if request.endpoint == 'security_guidelines' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                    </svg>
                    <span>Security Guidelines</span>
                </a>
                <a href="{{ url_for('recent_activity') }}" class="nav-item {% if request.endpoint == 'recent_activity' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                    <span>Recent Activity</span>
                </a>
                <a href="{{ url_for('device_security') }}" class="nav-item {% if request.endpoint == 'device_security' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="5" y="2" width="14" height="20" rx="2" ry="2"></rect>
                        <line x1="12" y1="18" x2="12.01" y2="18"></line>
                    </svg>
                    <span>Device Security</span>
                </a>
                <a href="{{ url_for('account_protection') }}" class="nav-item {% if request.endpoint == 'account_protection' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                        <polyline points="9 12 11 14 15 10"></polyline>
                    </svg>
                    <span>Account Protection Level</span>
                </a>
                <a href="{{ url_for('access_history') }}" class="nav-item {% if request.endpoint == 'access_history' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <span>View Access History</span>
                </a>
                <a href="{{ url_for('generate_code') }}" class="nav-item {% if request.endpoint == 'generate_code' %}active{% endif %}">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="5" height="5"></rect>
                        <rect x="3" y="16" width="5" height="5"></rect>
                        <rect x="16" y="3" width="5" height="5"></rect>
                        <rect x="16" y="16" width="5" height="5"></rect>
                        <line x1="8" y1="8" x2="8" y2="8"></line>
                        <line x1="16" y1="8" x2="16" y2="8"></line>
                        <line x1="8" y1="16" x2="8" y2="16"></line>
                        <line x1="16" y1="16" x2="16" y2="16"></line>
                    </svg>
                    <span>Generate Access Code</span>
                </a>
                <div class="nav-divider"></div>
                <a href="{{ url_for('logout') }}" class="nav-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    <span>Logout</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
    {% endif %}
    
    {% block content %}{% endblock %}
    
    {% if current_user.is_authenticated and request.endpoint != 'login' %}
        </main>
    </div>
    {% endif %}

    <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
